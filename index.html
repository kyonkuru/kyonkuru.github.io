<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PeerJS接続テスト</title>
</head>
<body>
    <h1>PeerJS 接続テスト</h1>
    <p>ブラウザの開発者ツール（F12）を開き、コンソールを確認してください。Peer IDが表示されれば接続成功です。</p>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <script>
        // --- 接続設定 ---
        const PEER_SERVER_HOST = '192.168.0.11'; // あなたのサーバーのIPアドレスまたはドメイン名
        const PEER_SERVER_PORT = 9000;                       // PeerServerが起動しているポート
        const PEER_SERVER_PATH = '/myapp';                   // PeerServer起動時に指定したパス (指定しない場合は '/')
        
        // STUNサーバーの設定（NAT越えに必須）
        // Googleの無料STUNサーバーを使用
        const iceServers = [
            { urls: 'stun:stun.l.google.com:19302' } 
        ];

        // Peerオブジェクトの初期化
        const peer = new Peer({
            host: PEER_SERVER_HOST,
            port: PEER_SERVER_PORT,
            path: PEER_SERVER_PATH,
            secure: false, // 開発環境でHTTPS/SSLがない場合は false
            config: {
                iceServers: iceServers
            }
        });
        // --- 接続設定ここまで ---


        // PeerServerへの接続が成功し、クライアントのIDが割り振られたときの処理
        peer.on('open', (id) => {
            console.log('✅ PeerServerに接続成功！');
            console.log('割り当てられた Peer ID: ' + id);
            document.querySelector('h1').textContent = `Peer ID: ${id}`;
        });

        // 接続エラーが発生したときの処理
        peer.on('error', (err) => {
            console.error('❌ PeerServer接続エラーが発生しました:', err);
            document.querySelector('h1').textContent = '接続エラー: コンソールを確認';
        });

        // (デバッグ用) 接続が切断されたときの処理
        peer.on('disconnected', () => {
            console.warn('⚠️ PeerServerから切断されました。再接続を試みてください。');
        });

    </script>
</body>
</html>
